name: Keep Backend Alive

on:
  schedule:
    # Run every 10 minutes (Render free tier spins down after 15 min of inactivity)
    - cron: '*/12 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Root Endpoint
        run: |
          echo "ğŸ”„ Pinging backend at $(date)"
          
          BACKEND_URL="${{ secrets.BACKEND_URL }}"
          
          # Ping the root endpoint
          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")
          
          if [ $response -eq 200 ]; then
            echo "âœ… Root endpoint alive! Status code: $response"
          else
            echo "âš ï¸ Root endpoint responded with status code: $response"
          fi
          
      - name: Ping Health Check Endpoint
        run: |
          echo "ğŸ¥ Checking health endpoint..."
          
          BACKEND_URL="${{ secrets.BACKEND_URL }}"
          
          # Ping the health endpoint and capture response
          response=$(curl -s "$BACKEND_URL/health")
          status_code=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL/health")
          
          if [ $status_code -eq 200 ]; then
            echo "âœ… Health check passed! Status code: $status_code"
            echo "ğŸ“Š Response: $response"
          else
            echo "âš ï¸ Health check responded with status code: $status_code"
          fi
        continue-on-error: true

      - name: Ping API Health Endpoint
        run: |
          echo "ğŸ” Checking API health endpoint..."
          
          BACKEND_URL="${{ secrets.BACKEND_URL }}"
          
          # Ping the API health endpoint
          response=$(curl -s "$BACKEND_URL/api/health")
          status_code=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL/api/health")
          
          if [ $status_code -eq 200 ]; then
            echo "âœ… API health check passed! Status code: $status_code"
            echo "ğŸ“Š Response: $response"
          else
            echo "âš ï¸ API health check responded with status code: $status_code"
          fi
        continue-on-error: true

      - name: Log Completion
        run: |
          echo "ğŸ‰ Backend keep-alive ping completed at $(date)"
          echo "â° Next ping in 12 minutes"